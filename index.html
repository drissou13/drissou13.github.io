let previousReposIds = [];
let currentPage = 1;
const projectsPerPage = 5;
let allRepos = [];

async function checkDemo(url) {
  try {
    const res = await fetch(url, { method: 'HEAD' });
    return res.ok;
  } catch {
    return false;
  }
}

// Charger les projets GitHub et afficher la premiÃ¨re page
async function loadRepos() {
  const res = await fetch("https://api.github.com/users/drissou13/repos");
  const repos = await res.json();
  allRepos = repos;
  displayPage(currentPage);
}

async function displayPage(pageNumber) {
  const container = document.getElementById("content-container");
  const nav = document.getElementById("page-nav");

  const start = (pageNumber - 1) * projectsPerPage;
  const end = start + projectsPerPage;
  const pageRepos = allRepos.slice(start, end);

  container.innerHTML = ""; // Clear current page content

  pageRepos.forEach((repo) => {
    const demoUrl = `https://drissou13.github.io/${repo.name}`;
    const hasDemo = await checkDemo(demoUrl);

    const div = document.createElement("div");
    div.className = "repo";

    const newBadge = !previousReposIds.includes(repo.id) ? `<span class="badge-new">Nouveau</span>` : "";

    div.innerHTML = `
      <h3>${repo.name} ${newBadge}</h3>
      <p>${repo.description || "Aucune description disponible."}</p>
      ${hasDemo ? `
        <iframe src="${demoUrl}"></iframe>
        <button onclick="window.open('${demoUrl}', '_blank')">Ouvrir dans une nouvelle fenÃªtre ðŸš€</button>
        <p class="note">DÃ©mo GitHub Pages active</p>
      ` : `
        <a href="${repo.html_url}" target="_blank">Voir le code ðŸ“‚</a>
        <p class="note">Pas de dÃ©mo dÃ©tectÃ©e</p>
      `}
    `;

    container.appendChild(div);
    previousReposIds.push(repo.id);
  });

  updatePagination();
  animatePageTransition();
}

function updatePagination() {
  const nav = document.getElementById("page-nav");
  nav.innerHTML = "";
  const totalPages = Math.ceil(allRepos.length / projectsPerPage);

  for (let i = 1; i <= totalPages; i++) {
    const pageLink = document.createElement("a");
    pageLink.href = "javascript:void(0)";
    pageLink.textContent = `Page ${i}`;
    pageLink.onclick = () => {
      currentPage = i;
      displayPage(i);
    };
    nav.appendChild(pageLink);
  }
}

// Fonction pour ajouter une transition d'animation de changement de page
function animatePageTransition() {
  const currentPageContent = document.querySelector(".page-active");
  if (currentPageContent) {
    currentPageContent.classList.remove("page-active");
    currentPageContent.classList.add("page-hidden");
  }
  const newPageContent = document.querySelector(".page-active");
  if (newPageContent) {
    newPageContent.classList.remove("page-hidden");
    newPageContent.classList.add("page-active");
  }
}

// Charger les projets dÃ¨s que la page est prÃªte
loadRepos();
